# ───────────────────────────────────────────────────────────────
# 🗃️  Orion SQL Writer — Persistence Layer
# Subscribes to enriched events and writes them to Postgres
# ───────────────────────────────────────────────────────────────

# --- Service Identity ---
SERVICE_NAME=sql-writer
SERVICE_VERSION=0.2.0
PORT=8220

# --- Orion Bus Integration ---
ORION_BUS_ENABLED=true
ORION_BUS_URL=redis://${PROJECT}-bus-core:6379/0

# --- Bus Channels Listen / Publish ---
CHANNEL_TAGS_RAW=orion:tags
CHANNEL_TAGS_ENRICHED=orion:tags:enriched

CHANNEL_COLLAPSE_TRIAGE=orion:collapse:triage
CHANNEL_COLLAPSE_PUBLISH=orion:collapse:sql-write

# --- Database Configuration ---
POSTGRES_URI=postgresql://postgres:postgres@${PROJECT}-sql-db:5432/conjourney

# --- Table Routing Map ---
# Maps each channel to a Postgres target table
# format: channel_name:table_name (comma-separated)
BUS_TABLE_MAP=orion:collapse:triage:collapse_mirror,orion:tags:raw:collapse_tags_raw,orion:tags:enriched:collapse_enrichment,orion:chat:history:log:chat_history,orion:rag:document:add:rag_documents

# --- Polling / Timing ---
POLL_TIMEOUT=1.0

# --- Network / Project ---
PROJECT=orion-janus
NET=app-net
