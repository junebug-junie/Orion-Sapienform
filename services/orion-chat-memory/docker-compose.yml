version: "3.9"

services:
  orion-chat-memory:
    build:
      context: ../..
      dockerfile: services/orion-chat-memory/Dockerfile
    container_name: ${PROJECT:-orion}-chat-memory
    restart: unless-stopped
    environment:
      - SERVICE_NAME=${SERVICE_NAME}
      - SERVICE_VERSION=${SERVICE_VERSION}
      - NODE_NAME=${NODE_NAME}
      - LOG_LEVEL=${LOG_LEVEL}

      - ORION_BUS_URL=${ORION_BUS_URL}
      - ORION_BUS_ENFORCE_CATALOG=${ORION_BUS_ENFORCE_CATALOG}
      - ORION_BUS_ENABLED=${ORION_BUS_ENABLED}

      - CHAT_MEMORY_INPUT_CHANNELS=${CHAT_MEMORY_INPUT_CHANNELS}
      - CHAT_MEMORY_COLLECTION=${CHAT_MEMORY_COLLECTION}
      - CHAT_MEMORY_UPSERT_CHANNEL=${CHAT_MEMORY_UPSERT_CHANNEL}
      - CHAT_MEMORY_CHUNK_INTERVAL=${CHAT_MEMORY_CHUNK_INTERVAL}

      - CHAT_MEMORY_EMBED_ENABLE=${CHAT_MEMORY_EMBED_ENABLE}
      - CHAT_MEMORY_EMBED_MODE=${CHAT_MEMORY_EMBED_MODE}
      - CHAT_MEMORY_EMBED_REQUEST_CHANNEL=${CHAT_MEMORY_EMBED_REQUEST_CHANNEL}
      - CHAT_MEMORY_EMBED_RESULT_CHANNEL=${CHAT_MEMORY_EMBED_RESULT_CHANNEL}
      - CHAT_MEMORY_EMBED_HOST_URL=${CHAT_MEMORY_EMBED_HOST_URL}
      - CHAT_MEMORY_INCLUDE_LATENTS=${CHAT_MEMORY_INCLUDE_LATENTS}
      - CHAT_MEMORY_EMBED_TIMEOUT_MS=${CHAT_MEMORY_EMBED_TIMEOUT_MS}
      - CHAT_MEMORY_EMBED_PROFILE=${CHAT_MEMORY_EMBED_PROFILE}

    ports:
      - "${PORT:-8011}:8000"
