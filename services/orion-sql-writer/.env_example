# ───────────────────────────────────────────────────────────────
# ✍️  Orion SQL Writer
# ───────────────────────────────────────────────────────────────

# Identity
SERVICE_NAME=sql-writer
SERVICE_VERSION=0.4.0
#NODE_NAME=athena
PORT=8220
#PROJECT=orion-athena
#NET=app-net

# --- Bus ---
ORION_BUS_ENABLED=true
ORION_BUS_ENFORCE_CATALOG=true
#ORION_BUS_URL=redis://orion-redis:6379/0
ORION_HEARTBEAT_INTERVAL_SEC=10.0
ORION_ERROR_CHANNEL=orion:system:error
ORION_SHUTDOWN_GRACE_SEC=10.0

# --- Routing ---
# Wrap the JSON list in single quotes (so commas don't break your shell)
# Legacy spark introspection channel is disabled by default. Re-add to subscribe explicitly if needed.
SQL_WRITER_SUBSCRIBE_CHANNELS=["orion:tags:enriched","orion:collapse:sql-write","orion:chat:history:log","orion:dream:log","orion:telemetry:biometrics","orion:biometrics:summary","orion:biometrics:induction","orion:spark:telemetry","orion:cognition:trace","orion:metacognition:tick","orion:metacognition:enriched","orion:equilibrium:metacog:trigger"]
SQL_WRITER_ENABLE_SPARK_SNAPSHOT_CHANNEL=true
SPARK_LEGACY_MODE=drop

# Wrap the JSON map in single quotes
# Map: envelope.kind -> MODEL_MAP key in services/orion-sql-writer/app/worker.py
# Update this line in your .env file:
SQL_WRITER_ROUTE_MAP_JSON={"collapse.mirror":"CollapseMirror","collapse.mirror.entry.v2":"CollapseMirror","collapse.enrichment":"CollapseEnrichment","tags.enriched":"CollapseEnrichment","chat.history":"ChatHistoryLogSQL","chat.log":"ChatHistoryLogSQL","dream.log":"Dream","biometrics.telemetry":"BiometricsTelemetry","biometrics.summary.v1":"BiometricsSummarySQL","biometrics.induction.v1":"BiometricsInductionSQL","spark.telemetry":"SparkTelemetrySQL","spark.state.snapshot.v1":"SparkTelemetrySQL","cognition.trace":"CognitionTraceSQL","chat.history.message.v1":"ChatMessageSQL","metacognition.tick.v1":"MetacognitionTickSQL","orion.metacog.trigger.v1":"MetacogTriggerSQL"}

# --- DB ---
DATABASE_URL=postgresql://postgres:postgres@orion-athena-sql-db:5432/conjourney
POSTGRES_URI=postgresql://postgres:postgres@orion-athena-sql-db:5432/conjourney
ORION_HEALTH_CHANNEL=orion:system:health
