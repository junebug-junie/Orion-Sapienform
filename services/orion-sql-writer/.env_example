 ───────────────────────────────────────────────────────────────
# 🗃️ Orion SQL Writer — Persistence Layer
# Subscribes to enriched events and writes them to Postgres
# ───────────────────────────────────────────────────────────────

# --- Service Identity ---
SERVICE_NAME=sql-writer
SERVICE_VERSION=0.2.0
PORT=8220

# --- Orion Bus Integration ---
ORION_BUS_ENABLED=true
ORION_BUS_URL=redis://${PROJECT}-bus-core:6379/0

# --- Bus Channels ---
# Explicit and consistent naming — avoids ambiguous comma lists
CHANNEL_TAGS_RAW=orion:tags
CHANNEL_TAGS_ENRICHED=orion:tags:enriched
CHANNEL_COLLAPSE_INTAKE=orion:collapse:intake
CHANNEL_RDF_CONFIRM=orion:rdf:confirm

# --- Database Configuration ---
POSTGRES_URI=postgresql://postgres:postgres@${PROJECT}-sql-db:5432/conjourney

# --- Table Routing Map ---
# Maps each channel to a Postgres target table
BUS_TABLE_MAP=orion:tags:enriched:collapse_enrichment,orion:tags:collapse_enrichment,orion:collapse:intake:collapse_mirror

# --- Polling / Timing ---
POLL_TIMEOUT=1.0

# --- Network / Project ---
PROJECT=orion-janus
NET=app-net
