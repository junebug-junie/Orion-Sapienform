services:
  cortex-orchestrator:
    build:
      context: ../..
      dockerfile: services/orion-cortex-orch/Dockerfile
    container_name: ${PROJECT}-cortex-orch
    env_file:
      - .env
    ports:
      - "8072:8072"
    restart: unless-stopped

    environment:
      NODE_NAME: ${NODE_NAME}
      SERVICE_NAME: ${SERVICE_NAME}
      SERVICE_VERSION: ${SERVICE_VERSION}

      HEARTBEAT_INTERVAL_SEC: ${HEARTBEAT_INTERVAL_SEC}

      ORION_BUS_URL: ${ORION_BUS_URL}
      ORION_BUS_ENABLED: ${ORION_BUS_ENABLED}

      ORION_STATE_ENABLED: ${ORION_STATE_ENABLED:-true}
      STATE_REQUEST_CHANNEL: ${STATE_REQUEST_CHANNEL:-orion-state:request}
      STATE_RESULT_PREFIX: ${STATE_RESULT_PREFIX:-orion-state:reply}
      STATE_TIMEOUT_SEC: ${STATE_TIMEOUT_SEC:-2.0}
      STATE_SCOPE: ${STATE_SCOPE:-global}
      STATE_NODE: ${STATE_NODE:-}

      EXEC_REQUEST_PREFIX: ${EXEC_REQUEST_PREFIX:-orion-exec:request}
      EXEC_RESULT_PREFIX: ${EXEC_RESULT_PREFIX:-orion-exec:result}

      ORION_CORTEX_STEP_TIMEOUT_MS: ${ORION_CORTEX_STEP_TIMEOUT_MS:-8000}
      ORCH_REQUEST_CHANNEL: ${ORCH_REQUEST_CHANNEL:-orion-cortex:request}
      ORCH_RESULT_PREFIX: ${ORCH_RESULT_PREFIX:-orion-cortex:result}

      API_HOST: ${API_HOST:-0.0.0.0}
      API_PORT: ${API_PORT:-8072}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
    networks:
      - app-net

networks:
  app-net:
    external: true
